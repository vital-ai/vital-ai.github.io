<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- <meta name="viewport" content="width=device-width, initial-scale=1" /> -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />



<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
		
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		
<!-- Customize home screen title. -->
<meta name="apple-mobile-web-app-title" content="CallidaEnergy Comfort App" />
		
<meta name="apple-mobile-web-app-status-bar-style" content="black" />


<title>CallidaEnergy Comfort App</title>
<link rel="stylesheet" href="css/jquery.mobile-1.4.4.min.css" />
<link rel="stylesheet" href="css/main.css" />
<link rel="stylesheet" href="css/dial.css" />
<link rel="stylesheet" href="css/map.css" />
<!-- <link rel="shortcut icon" href="favicon.ico" /> -->
<script src="js/jquery-2.1.0.min.js"></script>
<script src="js/jquery.cookie-1.4.1.js"></script>

<script src="js/dial.js"></script>
<script src="js/gmap.js"></script>
<script src="js/home.js"></script>
<!-- 
<script src="js/orientation.js"></script>
 -->

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>


<script>

	var COOKIE_LAST_VIEWED_SCREEN = "LAST_VIEWED_SCREEN";
	
	
	/*
	$('body').on('vmousemove', function(event) {
        event.stopPropagation();
		//event.preventDefault();
        //event.stopImmediatePropagation();
	});
	*/
	
	$(function() {
		
		
		$(document).on('vmousemove', function(event) {
			event.preventDefault();
	        //event.stopImmediatePropagation();
	        event.stopPropagation();
		});
		
		
		
		$("[data-role='navbar']").navbar();
		
		$("[data-role='header'], [data-role='footer']").toolbar();
		
		
		
		
		
		$('#main-header .ui-btn').on('tap', function(event){
			
			event.preventDefault();
			event.stopPropagation();
			
			var btn = $(this);
			
			var clicked = btn.attr('href').substring(1);

			navigateTo(clicked);
			
		});
		
		
		/*
		$('body').on("swipeleft", function(event){
			
			//alert("swipe left on: " + current);
			
			var current = $(".ui-page-active").attr('id');
			
			var n = null;
			if(current == 'home') {
				return;
			}else if(current == 'comfort-level') {
				n = 'home';
			} else if(current == 'select-building') {
				n = 'comfort-level';
			}
			
			$.mobile.navigate( '#' + n, {});
			
		});
		
		$('body').on("swiperight", function(event){
			
			var current = $(".ui-page-active").attr('id');
			
			var n = null;
			if(current == 'home') {
				return;
			}else if(current == 'comfort-level') {
				n = 'home';
			} else if(current == 'select-building') {
				n = 'comfort-level';
			}
			
			$.mobile.navigate( '#' + n, {});
			
			//alert("swipe right on: " + current);
			
		}); 
		*/
		
		
		//init gmaps here
		google.maps.event.addDomListener(window, 'load', initialize_gmaps);
		
		
	});


	
	var firstChange = true;
	
	$(document).on("pagecontainerchange", function() {
		// Each of the four pages in this demo has a data-title attribute
		// which value is equal to the text of the nav button
		// For example, on first page: <div data-role="page" data-title="Info">
		var current = $(".ui-page-active").attr('id');
		console.log("pagecontainerchange, current page: " + current);
		//alert("current: " +current);
		// Change the heading
		//$( "[data-role='header'] h1" ).text( current );
		// Remove active class from nav buttons
		$( "[data-role='navbar'] a.ui-btn-active" ).removeClass( "ui-btn-active" );
		// Add active class to current nav button
		$("[data-role='navbar'] a").each(function() {
			if ($(this).attr('href') === '#' + current) {
				$(this).addClass("ui-btn-active");
			}
		});
		
		if(firstChange == true) {
			firstChange = false;			
		} else {
			$.cookie(COOKIE_LAST_VIEWED_SCREEN , current, { expires: 365, path: '/' });
		}
		
		if(current == 'comfort-level') {
			onDialPageShown();
		} else if(current == 'select-building') {
			onMapPageShown();
		} else if(current == 'home') {
			onHomePageShown();
		}
		
		
		
	});
	
	
</script>

</head>
<body>

	<div id="main-header" data-role="header" data-position="fixed" data-theme="a">
		<div data-role="navbar" data-iconpos="left">
			<ul>
				<li><a href="#home" data-prefetch="true"
					data-transition="slide" 
					
					>
					<!-- <img src="img/welcome.png" height="13" /> -->
					Welcome</a></li>
				<li><a href="#comfort-level" data-prefetch="true"
					data-transition="slide"
					
					>
					<!-- <img src="img/comfort.png" height="13" /> -->
					Comfort Level</a></li>
				<li><a href="#select-building" data-prefetch="true"
					data-transition="slide"
					
					>
					<!-- <img src="img/building.png" height="13" />  -->
					Select Building</a></li>
			</ul>
		</div>
		<!-- /navbar -->
	</div>
	<!-- /header -->

	<div data-role="page" id="home">
		<div class="ui-content" id="home-body">
			<div id="home-header">
				<img alt="CallidaEnergy logo" src="img/Callida-grey.png" title="CallidaEnergy" height="100"/>
				<br/>
				<h3>The building comfort tracking app</h3>
			</div>
			<div id="home-center">
				To track your comfort level, please
				select your building location
				and submit your comfort level
			</div>
			<div id="home-bottom">
				<div id="home-next-button" class="round-button outer">
					<div class="inner">Next</div>
				</div>
			</div>
		</div>
	</div>

	<div data-role="page" id="comfort-level">
		<div class="ui-content" id="comfort-level-body">
			<div id="dial-selected-address" data-default="(no address selected)">(no address selected)</div>
			<h1 id="dial-header">What is your comfort level?</h1>
			<!-- <div style="text-align: center;">0 = comfortable</div> -->
			<!-- 
			<div id="circle" style="height: 0px;">
				<div id="handler">0</div>
				<p id="test">0</p>
			</div>
			 -->
			<!-- 
			<div id="bottom-labels">
				<div style="float: left;">10 = very warm</div>
				<div style="float: right;">-10 = very cold</div>
				<div style="clear: both;"></div>
			</div>
			-->
			<div id="bottom-buttons">
			
				<div id="submit-button" class="round-button outer">
					<div class="inner">Submit</div>
				</div>
			
				<!-- <button id="submit-button">Submit</button> -->
				<!-- 
				<button data-role="none" onclick="dial_onPlaceChanged({formatted_address: '349 5th Ave New York'});">set place</button>
				<button data-role="none" onclick="dial_onPlaceChanged(null);">clear place</button>
				 --> 
			</div>
			<div id="submit-status">
				&nbsp;
			</div>
		</div>
	</div>

	<div data-role="page" id="select-building">
		<div class="ui-content" id="select-building-body">
				<!-- 
			<div id="address-box-panel">
				<div id="address-box-selected">
					<div id="address-box-mglass"></div>
					<div id="address-box-remove"></div>
					<div id="address-box-selected-address" data-default="(no place selected)"></div>
					<div class="clearer"></div>
				</div>
				<div id="address-box-notselected" style="margin-left: 30px; margin-right: 30px;">
					<input data-role="" id="pac-input" class="controls" type="text" placeholder="Search Box"/>
				</div>
			</div>
				-->
			<input data-role="none" id="pac-input" class="controls" type="text" placeholder="Search Box"/>
    		<div id="map-canvas"></div>
			<!-- 
    		<div id="address-box-notselected" style="margin-left: 30px; margin-right: 30px;">
				<input data-role="" id="pac-input" class="controls" type="text" placeholder="Search Box"/>
			</div>
			 -->
    		<div id="selected-location-panel">
    			<div id="address-box-remove"></div>
    			<div id="selected-address-text" data-default="(no place selected)"></div>
    			<div class="clearer"></div>
    		</div>
    	</div>
	</div>


<script>

	var lastScreen = $.cookie(COOKIE_LAST_VIEWED_SCREEN);

	console.log("last viewed screen: " + lastScreen);

	if(lastScreen != null && lastScreen != '' && lastScreen != 'home') {
	
		//switch the pages order as soon as jquery mobile is ready?
	
		console.log("transition to another screen - make it first element before jquery mobile launches!");
	
		$('#' + lastScreen).insertBefore($('#home'));
		
	
	}	
</script>
<script src="js/jquery.mobile-1.4.4.min.js"></script>

</body>
</html>

